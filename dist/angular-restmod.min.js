/**
 * API Bound Models for AngularJS
 * @version v0.15.0 - 2014-05-20
 * @link https://github.com/angular-platanus/restmod
 * @author Ignacio Baixas <iobaixas@gmai.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,b){"use strict";a.module("plRestmod",["ng","platanus.inflector"]);var c={chain:function(a,b){return a?function(c){return b.call(this,a.call(this,c))}:b},override:function(a,b){return a&&"function"==typeof b?function(){var c=this.$super;try{return this.$super=a,b.apply(this,arguments)}finally{this.$super=c}}:b},extendOverriden:function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=c.override(a[d],b[d]))}};a.module("plRestmod").constant("Utils",c);var d=a.bind,e=a.forEach,f=a.extend,g=a.noop,h=a.isObject,i=a.isArray,j=a.isFunction,k=Array.prototype.slice,l=[],m="C",n="U",o="R",p="CU",q="CRU";a.module("plRestmod").provider("$restmod",function(){var a=[];return{pushModelBase:function(){return Array.prototype.push.apply(a,arguments),this},$get:["$http","$q","$injector","$parse","$filter","$inflector",function(r,s,t,u,v,w){var x={$dispatch:function(a,b,c){var d,e,f;if(c||(c=this),this.$$dsp&&this.$$dsp(a,b,c),this.$$cb&&(d=this.$$cb[a]))for(e=0;f=d[e];e++)f.apply(c,b||l);return this.$scope&&this.$scope.$dispatch&&this.$scope.$dispatch.call(this.$scope,a,b,c),this},$on:function(a,b){var c=(this.$$cb||(this.$$cb={}))[a]||(this.$$cb[a]=[]);return c.push(b),this},$decorate:function(a,b){var c=this.$$dsp;this.$$dsp="function"==typeof a?a:function(b,d,e){c&&c.apply(null,arguments);var f=a[b];f&&f.apply(e,d||l)};try{return b.call(this)}finally{this.$$dsp=c}},$dispatcher:function(){return this.$$dsp||g},$then:function(a,b){return this.$promise=this.$promise.then(a,b),this},$finally:function(a){return this.$promise=this.$promise["finally"](a),this},$send:function(a,c,d){function e(){return a.canceled?(f.$status="canceled",s.resolve(f)):(f.$decorate(g,function(){this.$response=null,this.$error=!1,this.$dispatch("before-request",[a])}),r(a).then(function(d){return a.canceled?(f.$status="canceled",f):(f.$decorate(g,function(){this.$pending.splice(this.$pending.indexOf(a),1),0===this.$pending.length&&(this.$pending=b),this.$status="ok",this.$response=d,this.$dispatch("after-request",[d]),c&&c.call(this,d)}),f)},function(b){return a.canceled?(f.$status="canceled",f):(f.$decorate(g,function(){this.$pending.splice(this.$pending.indexOf(a),1),0===this.$pending.length&&(this.$pending=null),this.$status="error",this.$response=b,this.$dispatch("after-request-error",[b]),d&&d.call(this,b)}),s.reject(f))}))}var f=this,g=this.$dispatcher();return this.$pending=this.$pending||[],this.$pending.push(a),this.$promise=this.$promise?this.$promise.then(e,e):e(),this},$cancel:function(){return this.$pending&&e(this.$pending,function(a){a.canceled=!0}),this.$promise=null,this}},y={model:function(g){function l(a,c,d,e,f,g){var h,i,j,k,l,m,n,o=g||{};for(h in a)if(a.hasOwnProperty(h)&&"$"!==h[0]){if(i=f&&H?H(h):h,k=d+i,l=B[k],l&&-1!==l.indexOf(e))continue;if(n=a[h],m=f?F[k]:G[k]){if(n=m.call(c,n),n===b)continue}else"object"==typeof n&&n&&(f||"function"!=typeof n.toJSON)&&(n=r(n,c,k,e,f));j=!f&&I?I(i):i,o[j]=n}return o}function r(a,b,c,d,e){if(i(a)){var f,g,h,j=c+"[]",k=e?F[j]:G[j],m=[];for(f=0,g=a.length;g>f;f++)h=a[f],k?h=k.call(b,h):"object"==typeof h&&h&&(e||"function"!=typeof h.toJSON)&&(h=r(h,b,c,d,e)),m.push(h);return m}return l(a,b,c+".",d,e)}function s(a,b){return a&&b?(a+"").replace(/\/$/,"")+"/"+(b+"").replace(/(\/$|^\/)/g,""):null}function y(a,b){this.$scope=a||y,this.$pk=b,this.$type=y;for(var c,d=0;c=E[d];d++)this[c[0]]="function"==typeof c[1]?c[1].apply(this):c[1];this.$dispatch("after-init")}function z(a){for(var b=0,c=a.length;c>b;b++)A(a[b])}function A(a){a.$chain?z(a.$chain):"string"==typeof a?A(t.get(a)):i(a)||j(a)?t.invoke(a,L,{$builder:L}):L.describe(a)}var B={},C=null,D="id",E=[],F={},G={},H=w.camelize,I=function(a){return w.parameterize(a,"_")};y.$single=function(a){return new y({$urlFor:function(){return C?s(C,a):a}},"")},y.$anonymous=function(){return!g},y.$baseUrl=function(){return C?s(C,g):g},y.$inferKey=function(a){return a&&"undefined"!=typeof a[D]?a[D]:null},y.$$setMask=function(a,b){b?B[a]=b===!0?q:b:delete B[a]},y.prototype=f({$url:function(){return this.$scope.$urlFor(this.$pk)},$buildScope:function(a,b){if(!a.$buildOwnScope){var c=this;return{$url:function(){return s(c.$url(),b)},$urlFor:function(b){return a.$anonymous()?this.$fetchUrlFor():a.$urlFor(b)},$fetchUrlFor:function(){return s(c.$url(),b)},$createUrlFor:function(){return null}}}},$extend:function(a){for(var b in a)a.hasOwnProperty(b)&&"$"!==b[0]&&(this[b]=a[b]);return this},$each:function(a,b){for(var c in this)this.hasOwnProperty(c)&&"$"!==c[0]&&a.call(b||this[c],this[c],c);return this},$decode:function(a,b){return l(a,this,"",b||o,!0,this),this.$pk||(this.$pk=y.$inferKey(a)),this.$dispatch("after-feed",[a]),this},$encode:function(a){var b=l(this,this,"",a||m,!1);return this.$dispatch("before-render",[b]),b},$fetch:function(a){var b=this.$scope.$fetchUrlFor?this.$scope.$fetchUrlFor(this.$pk):this.$url();if(!b)throw new Error("Cannot fetch an unbound resource");var c={method:"GET",url:b,params:a};return this.$dispatch("before-fetch",[c]),this.$send(c,function(a){var b=a.data;if(!b||i(b))throw new Error("Expected object while feeding resource");this.$decode(b),this.$dispatch("after-fetch",[a])},function(a){this.$dispatch("after-fetch-error",[a])})},$save:function(){var a,c=this.$scope.$updateUrlFor?this.$scope.$updateUrlFor(this.$pk):this.$url();if(c)return a={method:"PUT",url:c,data:this.$encode(m)},this.$dispatch("before-update",[a]),this.$dispatch("before-save",[a]),this.$send(a,function(a){var b=a.data;b&&!i(b)&&this.$decode(b),this.$dispatch("after-update",[a]),this.$dispatch("after-save",[a])},function(a){this.$dispatch("after-update-error",[a]),this.$dispatch("after-save-error",[a])});if(c=this.$scope.$createUrlFor?this.$scope.$createUrlFor(this.$pk):this.$scope.$url&&this.$scope.$url(),!c)throw new Error("Create is not supported by this resource");return a={method:"POST",url:c,data:this.$encode(n)},this.$dispatch("before-save",[a]),this.$dispatch("before-create",[a]),this.$send(a,function(a){var c=a.data;c&&!i(c)&&this.$decode(c),this.$scope.$isCollection&&this.$position===b&&!this.$preventReveal&&this.$scope.$add(this,this.$revealAt),this.$dispatch("after-create",[a]),this.$dispatch("after-save",[a])},function(a){this.$dispatch("after-create-error",[a]),this.$dispatch("after-save-error",[a])})},$destroy:function(){var a=this.$scope.$destroyUrlFor?this.$scope.$destroyUrlFor(this.$pk):this.$url();if(!a)throw new Error("Cannot destroy an unbound resource");var b={method:"DELETE",url:a};return this.$dispatch("before-destroy",[b]),this.$send(b,function(a){this.$scope.$remove&&this.$scope.$remove(this),this.$dispatch("after-destroy",[a])},function(a){this.$dispatch("after-destroy-error",[a])})},$moveTo:function(a){return this.$position!==b||(this.$revealAt=a),this},$reveal:function(a){return a===b||a?this.$scope.$add(this,this.$revealAt):this.$preventReveal=!0,this}},x);var J={$url:function(){return this.$scope?this.$scope.$url():y.$baseUrl()},$urlFor:function(a){var b=y.$baseUrl();return s(b?b:this.$url(),a)},$new:function(a){return new y(this,a)},$build:function(a){return this.$new().$extend(a)},$buildRaw:function(a){var b=this.$new(y.$inferKey(a));return b.$decode(a),b},$find:function(a){return this.$new(a).$fetch()},$create:function(a){return this.$build(a).$save()},$collection:function(a,b){var c=[];for(var d in J)this.hasOwnProperty(d)&&(c[d]=this[d]);return c.$isCollection=!0,c.$scope=b||this.$scope||y,c.$params=this.$params?f({},this.$params,a):a,c.$resolved=!1,c},$search:function(a){return this.$collection(a).$fetch()},$feed:function(a){if(!this.$isCollection)throw new Error("$feed is only supported by collections");this.$resolved||(this.length=0);for(var b=0,c=a.length;c>b;b++)this.$buildRaw(a[b]).$reveal();return this.$resolved=!0,this},$reset:function(){if(!this.$isCollection)throw new Error("$reset is only supported by collections");return this.$cancel(),this.$resolved=!1,this},$fetch:function(a){if(!this.$isCollection)throw new Error("$fetch is only supported by collections");var b={method:"GET",url:this.$url(),params:this.$params};return a&&(b.params=b.params?f(b.params,a):a),this.$dispatch("before-fetch-many",[b]),this.$send(b,function(a){var b=a.data;if(!b||!i(b))throw new Error("Error in resource {0} configuration. Expected response to be array");this.$feed(b),this.$dispatch("after-fetch-many",[a])},function(a){this.$dispatch("after-fetch-many-error",[a])}),this},$refresh:function(a){return this.$reset().$fetch(a)},$add:function(a,c){return this.$isCollection&&a.$position===b&&(c!==b?this.splice(c,0,a):this.push(a),a.$position=!0,this.$dispatch("after-add",[a])),this},$remove:function(a){var c=this.$indexOf(a);return-1!==c&&(this.splice(c,1),a.$position=b,this.$dispatch("after-remove",[a])),this},$indexOf:function(a){var b="function"==typeof a?a:!1;if(this.$isCollection)for(var c=0,d=this.length;d>c;c++)if(b?b(this[c]):this[c]===a)return c;return-1}},K={init:["attrDefault"],mask:["attrMask"],ignore:["attrMask"],decode:["attrDecoder","param","chain"],encode:["attrEncoder","param","chain"],serialize:["attrSerializer"],hasMany:["attrAsCollection","path","source","inverseOf"],hasOne:["attrAsResource","path","source","inverseOf"],belongsTo:["attrAsReference","inline","key","source","prefetch"]},L={setHttpOptions:function(){},setUrlPrefix:function(a){return C=a,this},setPrimaryKey:function(a){return D=a,this},setNameDecoder:function(a){return H=a,this},setNameEncoder:function(a){return I=a,this},disableRenaming:function(){return this.setNameDecoder(!1).setNameEncoder(!1)},extend:function(a,b,d){return"string"==typeof a?(this[a]=c.override(this[name],b),d&&(K[d[0]]=d,d[0]=a)):c.extendOverriden(this,a),this},describe:function(a){return e(a,function(a,b){switch(b.charAt(0)){case"@":this.classDefine(b.substring(1),a);break;case"~":b=w.parameterize(b.substring(1)),this.on(b,a);break;default:h(a)?this.attribute(b,a):j(a)?this.define(b,a):this.attrDefault(b,a)}},this),this},attribute:function(a,b){var c,d,e,f;for(c in b)if(b.hasOwnProperty(c)&&(d=K[c])){for(e=[a,b[c]],f=1;f<d.length;f++)e.push(b[d[f]]);e.push(b),this[d[0]].apply(this,e)}return this},attrDefault:function(a,b){return E.push([a,b]),this},attrMask:function(a,b){return y.$$setMask(a,b),this},attrSerializer:function(a,b,c){return"string"==typeof b&&(b=t.get(w.camelize(b,!0)+"Serializer")),j(b)&&(b=b(c)),b.decode&&this.attrDecoder(a,d(b,b.decode)),b.encode&&this.attrEncoder(a,d(b,b.encode)),this},attrDecoder:function(a,b,d,e){if("string"==typeof b){var f=v(b);b=function(a){return f(a,d)}}return F[a]=e?c.chain(F[a],b):b,this},attrEncoder:function(a,b,d,e){if("string"==typeof b){var f=v(b);b=function(a){return f(a,d)}}return G[a]=e?c.chain(G[a],b):b,this},attrAsCollection:function(a,b,c,d,e){return this.attrDefault(a,function(){"string"==typeof b&&(b=t.get(b),e&&b.$$setMask(e,p));var d=this,f=this.$buildScope(b,c||w.parameterize(a)),g=b.$collection(null,f);return e&&g.$on("after-add",function(a){a[e]=d}),g}).attrDecoder(d||c||a,function(b){this[a].$reset().$feed(b)}).attrMask(a,p)},attrAsResource:function(a,b,c,d,e){return this.attrDefault(a,function(){"string"==typeof b&&(b=t.get(b),e&&b.$$setMask(e,p));var d=this.$buildScope(b,c||w.parameterize(a)),f=new b(d);return e&&(f[e]=this),f}).attrDecoder(d||c||a,function(b){this[a].$decode(b)}).attrMask(a,p)},attrAsReference:function(a,b,c,d,e,f){var g=c?e||a:d||a+"Id";this.attrDefault(a,null).attrMask(a,p).attrDecoder(g,function(d){"string"==typeof b&&(b=t.get(b)),c?this[a]&&this[a].$pk===b.$inferKey(d)?this[a].$decode(d):this[a]=b.$buildRaw(d):this[a]&&this[a].$pk===d||(this[a]=b.$new(d),f&&this[a].$fetch())})},define:function(a,b){return"string"==typeof a?y.prototype[a]=c.override(y.prototype[a],b):c.extendOverriden(y.prototype,a),this},classDefine:function(a,b){return"string"==typeof a?J[a]=c.override(J[a],b):c.extendOverriden(J,a),this},on:function(a,b){return x.$on.call(y,a,b),this},attrExpression:function(a,b){var c=u(b);this.on("after-feed",function(){this[a]=c(this)})}};return z(a),z(y.$chain=k.call(arguments,1)),f(y,J,x),f(J,x),y},mixin:function(){return{$isAbstract:!0,$chain:k.call(arguments,0)}},singleton:function(a){return y.model.apply(this,arguments).$single(a)}};return y}]}}).factory("model",["$restmod",function(a){return a.model}]).factory("mixin",["$restmod",function(a){return a.mixin}])}(angular);