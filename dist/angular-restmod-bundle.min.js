/**
 * API Bound Models for AngularJS
 * @version v0.15.0 - 2014-07-21
 * @link https://github.com/angular-platanus/restmod
 * @author Ignacio Baixas <iobaixas@gmai.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,b){"use strict";!function(a){a.module("platanus.inflector",[]).factory("$inflector",function(){return{camelize:function(a,b){return"string"!=typeof a?a:a.replace(/(?:^[-_\s]*|[-_\s]+)([A-Z\d])/gi,function(a,c,d){return b||0!==d?c.toUpperCase():c})},parameterize:function(a,b){return"string"!=typeof a?a:a.replace(/[A-Z]/g,function(a,c){return 0===c?a:(b||"-")+a}).toLowerCase()},dasherize:function(a,b){return a.replace(/[-_\s]+/g,b||"-")}}})}(a);var c=a.module("plRestmod",["ng","platanus.inflector"]);c.provider("$restmod",[function(){var a=[];return{pushModelBase:function(){return Array.prototype.push.apply(a,arguments),this},$get:["RMModelFactory","RMBuilder",function(b,c){var d=Array.prototype.slice,e={model:function(e){var f=b(e),g=new c(f);return g.loadMixinChain(a),g.loadMixinChain(f.$chain=d.call(arguments,1)),f},mixin:function(){return{$isAbstract:!0,$chain:d.call(arguments,0)}},singleton:function(a){return e.model.apply(this,arguments).$single(a)}};return e}]}}]).factory("model",["$restmod",function(a){return a.model}]).factory("mixin",["$restmod",function(a){return a.mixin}]),c.factory("RMBuilder",["$injector","$parse","$filter","$inflector","RMUtils",function(b,c,d,e,f){function g(a){this.$$m=a,this.$$mappings={init:["attrDefault"],mask:["attrMask"],ignore:["attrMask"],decode:["attrDecoder","param","chain"],encode:["attrEncoder","param","chain"],serialize:["attrSerializer"],hasMany:["attrAsCollection","path","source","inverseOf"],hasOne:["attrAsResource","path","source","inverseOf"],belongsTo:["attrAsReference","inline","key","source","prefetch"]}}function h(a){this.dsl=new g(a)}var i=a.forEach,j=a.bind,k=a.isObject,l=a.isArray,m=a.isFunction;return g.prototype={setHttpOptions:function(){},setUrlPrefix:function(a){return this.$$m.$$setUrlPrefix(a),this},setPrimaryKey:function(a){return this.$$m.$$setPrimaryKey(a),this},setNameDecoder:function(a){return this.$$m.$$setNameDecoder(a),this},setNameEncoder:function(a){return this.$$m.$$setNameEncoder(a),this},disableRenaming:function(){return this.setNameDecoder(!1).setNameEncoder(!1)},setPacker:function(a){return this.$$m.$$setPacker(a),this},extend:function(a,b,c){return"string"==typeof a?(this[a]=f.override(this[name],b),c&&(this.$$mappings[c[0]]=c,c[0]=a)):f.extendOverriden(this,a),this},describe:function(a){return i(a,function(a,b){switch(b.charAt(0)){case"@":this.classDefine(b.substring(1),a);break;case"~":b=e.parameterize(b.substring(1)),this.on(b,a);break;default:k(a)?this.attribute(b,a):m(a)?this.define(b,a):this.attrDefault(b,a)}},this),this},attribute:function(a,b){var c,d,e,f;for(c in b)if(b.hasOwnProperty(c)&&(d=this.$$mappings[c])){for(e=[a,b[c]],f=1;f<d.length;f++)e.push(b[d[f]]);e.push(b),this[d[0]].apply(this,e)}return this},attrDefault:function(a,b){return this.$$m.$$setDefault(a,b),this},attrMask:function(a,b){return this.$$m.$$setMask(a,b),this},attrSerializer:function(a,c,d){return"string"==typeof c&&(c=b.get(e.camelize(c,!0)+"Serializer")),m(c)&&(c=c(d)),c.decode&&this.$$m.$$setDecoder(a,j(c,c.decode)),c.encode&&this.$$m.$$setEncoder(a,j(c,c.encode)),this},attrDecoder:function(a,b,c,d){return this.$$m.$$setDecoder(a,b,c,d),this},attrEncoder:function(a,b,c,d){return this.$$m.$$setEncoder(a,b,c,d),this},attrAsCollection:function(a,c,d,g,h){return this.$$m.$$setDefault(a,function(){"string"==typeof c&&(c=b.get(c),h&&c.$$setMask(h,f.WRITE_MASK));var g=this,i=this.$buildScope(c,d||e.parameterize(a)),j=c.$collection(null,i);return h&&j.$on("after-add",function(a){a[h]=g}),j}),this.$$m.$$setDecoder(g||d||a,function(b){this[a].$reset().$feed(b)}),this.$$m.$$setMask(a,f.WRITE_MASK),this},attrAsResource:function(a,c,d,g,h){return this.$$m.$$setDefault(a,function(){"string"==typeof c&&(c=b.get(c),h&&c.$$setMask(h,f.WRITE_MASK));var g=this.$buildScope(c,d||e.parameterize(a)),i=c.$new(null,g);return h&&(i[h]=this),i}),this.$$m.$$setDecoder(g||d||a,function(b){this[a].$decode(b)}),this.$$m.$$setMask(a,f.WRITE_MASK),this},attrAsReference:function(a,c,d,e,g,h){var i=d?g||a:e||a+"Id";return this.$$m.$$setDefault(a,null),this.$$m.$$setMask(a,f.WRITE_MASK),this.$$m.$$setDecoder(i,function(e){"string"==typeof c&&(c=b.get(c)),d?this[a]&&this[a].$pk===c.$$inferKey(e)?this[a].$decode(e):this[a]=c.$buildRaw(e):this[a]&&this[a].$pk===e||(this[a]=c.$new(e),h&&this[a].$fetch())}),this},define:function(a,b){return"string"==typeof a?this.$$m.prototype[a]=f.override(this.$$m.prototype[a],b):f.extendOverriden(this.$$m.prototype,a),this},classDefine:function(a,b){return this.$$m.$$addScopeMethod(a,b),this},on:function(a,b){return this.$$m.$on(a,b),this},attrExpression:function(a,b){var d=c(b);return this.$$m.$on("after-feed",function(){this[a]=d(this)}),this}},h.prototype={loadMixinChain:function(a){for(var b=0,c=a.length;c>b;b++)this.loadMixin(a[b])},loadMixin:function(a){a.$chain?this.loadMixinChain(a.$chain):"string"==typeof a?this.loadMixin(b.get(a)):l(a)||m(a)?b.invoke(a,this.dsl,{$builder:this.dsl}):this.dsl.describe(a)}},h}]),c.factory("RMCollectionApi",["RMUtils",function(c){var d=a.extend;return{$url:function(){return this.$scope.$url()},$urlFor:function(a){var b=this.$type.$url();return c.joinUrl(b?b:this.$url(),a)},$feed:function(b){if(!b||!a.isArray(b))throw new Error("Error in resource {0} configuration. Expected response to be array");this.$resolved||(this.length=0);for(var c=0,d=b.length;d>c;c++)this.$buildRaw(b[c]).$reveal();return this.$resolved=!0,this},$unwrap:function(a){return a=this.$$unpack(a),this.$feed(a)},$reset:function(){return this.$cancel(),this.$resolved=!1,this},$fetch:function(a){var b={method:"GET",url:this.$url(),params:this.$params};return a&&(b.params=b.params?d(b.params,a):a),this.$dispatch("before-fetch-many",[b]),this.$send(b,function(a){this.$unwrap(a.data),this.$dispatch("after-fetch-many",[a])},function(a){this.$dispatch("after-fetch-many-error",[a])}),this},$refresh:function(a){return this.$reset().$fetch(a)},$add:function(a,c){return a.$position===b&&(c!==b?this.splice(c,0,a):this.push(a),a.$position=!0,this.$dispatch("after-add",[a])),this},$remove:function(a){var c=this.$indexOf(a);return-1!==c&&(this.splice(c,1),a.$position=b,this.$dispatch("after-remove",[a])),this},$indexOf:function(a){for(var b="function"==typeof a?a:!1,c=0,d=this.length;d>c;c++)if(b?b(this[c]):this[c]===a)return c;return-1}}}]),c.factory("RMCommonApi",["$http","$q",function(c,d){var e=[],f={$dispatch:function(a,c,d){var f,g,h,i=this.$$dsp;if(d||(d=this),i&&(this.$$dsp=b,i(a,c,d)),this.$$cb&&(f=this.$$cb[a]))for(g=0;h=f[g];g++)h.apply(d,c||e);return this.$scope&&this.$scope.$dispatch?this.$scope.$dispatch(a,c,d):this.$type&&this.$type.$dispatch(a,c,d),this.$$dsp=i,this},$on:function(a,b){var c=(this.$$cb||(this.$$cb={}))[a]||(this.$$cb[a]=[]);return c.push(b),this},$decorate:function(a,b){var c=this.$$dsp;this.$$dsp="function"!=typeof a&&a?function(b,d,f){c&&c.apply(null,arguments);var g=a[b];g&&g.apply(f,d||e)}:a;try{return b.call(this)}finally{this.$$dsp=c}},$dispatcher:function(){return this.$$dsp},$then:function(a,b){return this.$promise||(this.$promise=d.when(this)),this.$promise=this.$promise.then(a,b),this},$finally:function(a){return this.$promise||(this.$promise=d.when(this)),this.$promise=this.$promise["finally"](a),this},$send:function(a,e,f){function g(){if(a.canceled)return h.$pending.splice(0,1),h.$status="canceled",d.when(h);h.$decorate(i,function(){this.$response=null,this.$status="pending",this.$dispatch("before-request",[a])});var g=c(a).then(function(c){return h.$decorate(i,function(){return this.$pending.splice(0,1),this.$promise===g&&(this.$promise=b),a.canceled?this.$status="canceled":(this.$status="ok",this.$response=c,this.$dispatch("after-request",[c]),e&&e.call(this,c)),this})},function(c){return h.$decorate(i,function(){return this.$pending.splice(0,1),this.$promise===g&&(this.$promise=b),a.canceled?(this.$status="canceled",this):(this.$status="error",this.$response=c,this.$dispatch("after-request-error",[c]),f&&f.call(this,c),d.reject(this))})});return g}var h=this,i=this.$dispatcher();return this.$pending=this.$pending||[],this.$pending.push(a),this.$promise=this.$promise?this.$promise.then(g,g):g(),this},$cancel:function(){return this.$pending&&a.forEach(this.$pending,function(a){a.canceled=!0}),this.$promise=null,this},$hasPendingRequests:function(){var b=0;return this.$pending&&a.forEach(this.$pending,function(a){a.canceled||b++}),b>0}};return f}]),c.factory("RMModelFactory",["$injector","$inflector","$filter","RMUtils","RMScopeApi","RMCommonApi","RMRecordApi","RMCollectionApi",function(c,d,e,f,g,h,i,j){return function(k){function l(a,b){this.$type=l,this.$scope=a||l,this.$pk=b,this.$initialize()}function m(a,b){var c=new A;return c.$isCollection=!0,c.$type=l,c.$scope=a,c.$params=b,c.$resolved=!1,c}var n=a.extend,o=a.isArray,p=null,q=null,r=null,s="id",t=null,u={},v=[],w={},x={},y=d.camelize,z=function(a){return d.parameterize(a,"_")};k&&("string"==typeof k?q=k:(q=k.url,r=k.name),!r&&q&&(r=q.replace(/(.*?)([^\/]+$)/,"$2")));var A=f.buildArrayType();n(l,{$$setUrlPrefix:function(a){p=a},$$setPrimaryKey:function(a){s=a},$$setNameDecoder:function(a){y=a},$$setNameEncoder:function(a){z=a},$$setPacker:function(a){"string"==typeof a&&(a=c.get(d.camelize(a,!0)+"Packer")),"function"==typeof a&&(a=new a(l)),t=a},$$setDefault:function(a,b){v.push([a,b])},$$setMask:function(a,b){b?u[a]=b===!0?f.FULL_MASK:b:delete u[a]},$$setDecoder:function(a,b,c,d){if("string"==typeof b){var g=e(b);b=function(a){return g(a,c)}}w[a]=d?f.chain(w[a],b):b},$$setEncoder:function(a,b,c,d){if("string"==typeof b){var g=e(b);b=function(a){return g(a,c)}}x[a]=d?f.chain(x[a],b):b},$$addScopeMethod:function(a,b){"string"==typeof a?(A.prototype[a]=f.override(A.prototype[a],b),l[a]=f.override(l[a],b)):(f.extendOverriden(A.prototype,a),f.extendOverriden(l,a))},$$inferKey:function(a){return a&&"undefined"!=typeof a[s]?a[s]:null},$$new:function(a,b){return new l(b||l,a)},$$collection:function(a,b){return m(b||l,a)},$getPrimaryKey:function(){return s},$anonymous:function(){return!q},$single:function(a){return new l({$urlFor:function(){return p?f.joinUrl(p,a):a}},"")},$url:function(){return p?f.joinUrl(p,q):q},$name:function(){return r},$urlFor:function(a){return f.joinUrl(this.$url(),a)}},g,h),n(l.prototype,{$$inferKey:l.$$inferKey,$$loadDefaults:function(){for(var a,b=0;a=v[b];b++)this[a[0]]="function"==typeof a[1]?a[1].apply(this):a[1]},$$pack:function(a){return t&&(a=t.pack(a,this)),a},$$unpack:function(a){return t&&(a=t.unpack(a,this)),a},$$transform:function(a,c,d,e,f){var g,h,i,j,k,l,m,n=f||{};for(g in a)if(a.hasOwnProperty(g)&&"$"!==g[0]){if(h=e&&y?y(g):g,j=c+h,k=u[j],k&&-1!==k.indexOf(d))continue;if(m=a[g],l=e?w[j]:x[j]){if(m=l.call(this,m),m===b)continue}else"object"==typeof m&&m&&(e||"function"!=typeof m.toJSON)&&(m=B.call(this,m,j,d,e));i=!e&&z?z(h):h,n[i]=m}return n}},i,h);var B=function(a,b,c,d){if(o(a)){var e,f,g,h=b+"[]",i=d?w[h]:x[h],j=[];for(e=0,f=a.length;f>e;e++)g=a[e],i?g=i.call(this,g):"object"==typeof g&&g&&(d||"function"!=typeof g.toJSON)&&(g=B.call(this,g,b,c,d)),j.push(g);return j}return this.$$transform(a,b+".",c,d)};return n(A.prototype,{$$inferKey:l.$$inferKey,$$new:function(a,b){return new l(b||this,a)},$$collection:function(a,b){return a=this.$params?n({},this.$params,a):a,m(b||this.$scope,a)},$$unpack:function(a){return t&&(a=t.unpackMany(a,this)),a}},j,g,h),l}}]),c.factory("RMRecordApi",["RMUtils",function(a){var c=function(a,b,c){this.$scope=a,this.$target=b,this.$partial=c};return c.prototype={$url:function(){return a.joinUrl(this.$scope.$url(),this.$partial)},$urlFor:function(a){return this.$target.$anonymous()?this.$fetchUrlFor():this.$target.$urlFor(a)},$fetchUrlFor:function(){return a.joinUrl(this.$scope.$url(),this.$partial)},$createUrlFor:function(){return null}},{$initialize:function(){this.$$loadDefaults(),this.$dispatch("after-init")},$url:function(){return this.$scope.$urlFor(this.$pk)},$buildScope:function(a,b){return a.$buildOwnScope?void 0:new c(this,a,b)},$extend:function(a){for(var b in a)a.hasOwnProperty(b)&&"$"!==b[0]&&(this[b]=a[b]);return this},$each:function(a,b){for(var c in this)this.hasOwnProperty(c)&&"$"!==c[0]&&a.call(b||this[c],this[c],c);return this},$decode:function(b,c){return this.$$transform(b,"",c||a.READ_MASK,!0,this),this.$pk||(this.$pk=this.$$inferKey(b)),this.$dispatch("after-feed",[b]),this},$encode:function(b){var c=this.$$transform(this,"",b||a.CREATE_MASK,!1);return this.$dispatch("before-render",[c]),c},$unwrap:function(a,b){return a=this.$$unpack(a),this.$decode(a,b)},$wrap:function(a){var b=this.$encode(a);return b=this.$$pack(b)},$fetch:function(a){var b=this.$scope.$fetchUrlFor?this.$scope.$fetchUrlFor(this.$pk):this.$url();if(!b)throw new Error("Cannot fetch an unbound resource");var c={method:"GET",url:b,params:a};return this.$dispatch("before-fetch",[c]),this.$send(c,function(a){this.$unwrap(a.data),this.$dispatch("after-fetch",[a])},function(a){this.$dispatch("after-fetch-error",[a])})},$save:function(){var c,d=this.$scope.$updateUrlFor?this.$scope.$updateUrlFor(this.$pk):this.$url();if(d)return c={method:"PUT",url:d,data:this.$wrap(a.UPDATE_MASK)},this.$dispatch("before-update",[c]),this.$dispatch("before-save",[c]),this.$send(c,function(a){this.$unwrap(a.data),this.$dispatch("after-update",[a]),this.$dispatch("after-save",[a])},function(a){this.$dispatch("after-update-error",[a]),this.$dispatch("after-save-error",[a])});if(d=this.$scope.$createUrlFor?this.$scope.$createUrlFor(this.$pk):this.$scope.$url&&this.$scope.$url(),!d)throw new Error("Create is not supported by this resource");return c={method:"POST",url:d,data:this.$wrap(a.CREATE_MASK)},this.$dispatch("before-save",[c]),this.$dispatch("before-create",[c]),this.$send(c,function(a){this.$unwrap(a.data),this.$scope.$isCollection&&this.$position===b&&!this.$preventReveal&&this.$scope.$add(this,this.$revealAt),this.$dispatch("after-create",[a]),this.$dispatch("after-save",[a])},function(a){this.$dispatch("after-create-error",[a]),this.$dispatch("after-save-error",[a])})},$destroy:function(){var a=this.$scope.$destroyUrlFor?this.$scope.$destroyUrlFor(this.$pk):this.$url();if(!a)throw new Error("Cannot destroy an unbound resource");var b={method:"DELETE",url:a};return this.$dispatch("before-destroy",[b]),this.$send(b,function(a){this.$scope.$remove&&this.$scope.$remove(this),this.$dispatch("after-destroy",[a])},function(a){this.$dispatch("after-destroy-error",[a])})},$moveTo:function(a){return this.$position!==b||(this.$revealAt=a),this},$reveal:function(a){return a===b||a?this.$scope.$add(this,this.$revealAt):this.$preventReveal=!0,this}}}]),c.factory("RMScopeApi",[function(){return{$new:function(a,b){return this.$$new(a,b)},$build:function(a){return this.$new().$extend(a)},$buildRaw:function(a){var b=this.$new(this.$$inferKey(a));return b.$decode(a),b},$find:function(a){return this.$new(a).$fetch()},$create:function(a){return this.$build(a).$save()},$collection:function(a,b){return this.$$collection(a,b)},$search:function(a){return this.$collection(a).$fetch()}}}]),c.factory("RMUtils",[function(){return{CREATE_MASK:"C",UPDATE_MASK:"U",READ_MASK:"R",WRITE_MASK:"CU",FULL_MASK:"CRU",joinUrl:function(a,b){return a&&b?(a+"").replace(/\/$/,"")+"/"+(b+"").replace(/(\/$|^\/)/g,""):null},chain:function(a,b){return a?function(c){return b.call(this,a.call(this,c))}:b},override:function(a,b){return a&&"function"==typeof b?function(){var c=this.$super;try{return this.$super=a,b.apply(this,arguments)}finally{this.$super=c}}:b},extendOverriden:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=this.override(a[c],b[c]))},buildArrayType:function(){var a,b=!0;if(b){var c=document.createElement("iframe");c.style.display="none",document.body.appendChild(c),frames[frames.length-1].document.write("<script>parent.RestmodArray = Array;</script>"),a=window.RestmodArray,delete window.RestmodArray,document.body.removeChild(c)}else a=function(){},a.prototype=[];return a}}}])}(angular);